<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GobLab Gran Canaria - Tu Mentor IA para Emprender</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;color:#333}
    .app-container{display:flex;height:100vh;max-width:1400px;margin:0 auto;background:rgba(255,255,255,.95);backdrop-filter:blur(10px)}
    .chat-panel{flex:1;display:flex;flex-direction:column;background:#fff;border-radius:20px 0 0 20px;box-shadow:0 10px 30px rgba(0,0,0,.1)}
    .chat-header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:25px 30px;border-radius:20px 0 0 0;position:relative}
    .mentor-info h1{font-size:24px;font-weight:600;margin-bottom:5px}
    .mentor-info p{font-size:14px;opacity:.9}
    .connection-status{position:absolute;top:15px;right:20px;display:flex;align-items:center;gap:8px;font-size:12px;background:rgba(255,255,255,.2);padding:5px 10px;border-radius:15px}
    .status-dot{width:8px;height:8px;border-radius:50%;background:#ff6b6b}
    .status-dot.connected{background:#51cf66}
    .chat-messages{flex:1;overflow-y:auto;padding:30px;background:#fafafa}
    .message{margin-bottom:25px;animation:slideIn .5s ease-out}
    @keyframes slideIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .message.ai{display:flex;gap:15px}
    .message.user{display:flex;gap:15px;flex-direction:row-reverse;margin-left:50px}
    .message-avatar{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
    .message.ai .message-avatar{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff}
    .message.user .message-avatar{background:linear-gradient(135deg,#4ade80 0%,#16a34a 100%);color:#fff}
    .message-content{flex:1;background:#fff;padding:20px;border-radius:18px;box-shadow:0 2px 10px rgba(0,0,0,.1)}
    .message.user .message-content{background:linear-gradient(135deg,#e0f2fe 0%,#b3e5fc 100%)}
    .message-text{line-height:1.6;font-size:15px}
    .error-message{background:linear-gradient(135deg,#ff6b6b 0%,#ee5a52 100%);color:#fff;padding:15px 20px;border-radius:12px;margin:20px 0;display:flex;align-items:center;gap:10px}
    .typing-indicator{display:flex;align-items:center;gap:15px;padding:20px 30px}
    .typing-dots{display:flex;gap:5px}
    .typing-dot{width:8px;height:8px;background:#667eea;border-radius:50%;animation:typingDot 1.4s infinite}
    .typing-dot:nth-child(2){animation-delay:.2s}
    .typing-dot:nth-child(3){animation-delay:.4s}
    @keyframes typingDot{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-10px)}}
    .chat-input{padding:25px 30px;background:#fff;border-top:1px solid #e5e7eb;border-radius:0 0 0 20px}
    .input-container{display:flex;gap:15px;align-items:flex-end}
    .input-field{flex:1;border:2px solid #e5e7eb;border-radius:25px;padding:15px 20px;font-size:15px;resize:none;min-height:50px;max-height:120px;transition:all .3s}
    .input-field:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}
    .send-button{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:none;width:50px;height:50px;border-radius:50%;font-size:20px;cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center}
    .send-button:hover{transform:scale(1.1);box-shadow:0 4px 15px rgba(102,126,234,.4)}
    .send-button:disabled{opacity:.5;cursor:not-allowed;transform:none}
    .progress-panel{width:400px;background:#fff;border-radius:0 20px 20px 0;box-shadow:0 10px 30px rgba(0,0,0,.1);display:flex;flex-direction:column}
    .progress-header{background:linear-gradient(135deg,#f59e0b 0%,#d97706 100%);color:#fff;padding:25px;border-radius:0 20px 0 0}
    .progress-title{font-size:18px;font-weight:600;margin-bottom:10px}
    .progress-subtitle{font-size:14px;opacity:.9}
    .plan-preview{flex:1;padding:25px;overflow-y:auto}
    .plan-section{margin-bottom:20px;padding:15px;background:#f8fafc;border-radius:8px;border-left:4px solid #e5e7eb;transition:all .3s}
    .plan-section.active{border-left-color:#f59e0b;background:#fffbeb}
    .plan-section.completed{border-left-color:#10b981;background:#ecfdf5}
    .section-title{font-size:14px;font-weight:600;margin-bottom:8px;display:flex;align-items:center;gap:8px}
    .section-status{width:18px;height:18px;border-radius:50%;background:#e5e7eb;display:flex;align-items:center;justify-content:center;font-size:10px;color:#fff}
    .section-status.active{background:#f59e0b;animation:pulse 2s infinite}
    .section-status.completed{background:#10b981}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
    .section-content{font-size:12px;color:#6b7280;line-height:1.4}
    .welcome-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:50px;height:100%}
    .welcome-icon{width:80px;height:80px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:36px;color:#fff;margin-bottom:25px;animation:bounce 2s infinite}
    @keyframes bounce{0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-10px)}60%{transform:translateY(-5px)}}
    .welcome-title{font-size:28px;font-weight:700;margin-bottom:15px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .welcome-subtitle{font-size:16px;color:#6b7280;margin-bottom:30px;max-width:400px;line-height:1.6}
    .start-button{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:none;padding:15px 30px;border-radius:25px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s}
    .start-button:hover{transform:translateY(-3px);box-shadow:0 10px 25px rgba(102,126,234,.4)}
    .quick-responses{display:flex;gap:10px;flex-wrap:wrap;margin-top:15px}
    .quick-response{background:rgba(102,126,234,.1);color:#667eea;border:1px solid rgba(102,126,234,.2);padding:8px 15px;border-radius:20px;font-size:13px;cursor:pointer;transition:all .3s}
    .quick-response:hover{background:#667eea;color:#fff;transform:translateY(-2px)}
    .message-actions{margin-top:15px;display:flex;gap:10px;flex-wrap:wrap}
    .action-btn{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:none;padding:8px 16px;border-radius:20px;font-size:13px;cursor:pointer;transition:all .3s}
    .action-btn:hover{transform:translateY(-2px);box-shadow:0 4px 15px rgba(102,126,234,.4)}
    @media (max-width:1024px){
      .app-container{flex-direction:column}
      .progress-panel{width:100%;height:200px;border-radius:0}
      .chat-panel{border-radius:0}
    }
  </style>
</head>
<body>
<div class="app-container">
  <div class="chat-panel">
    <div class="chat-header">
      <div class="mentor-info">
        <h1>Alex - Tu Mentor IA para crear Planes de Negocio</h1>
        <p>GobLab Gran Canaria - Laboratorio de Innovaci√≥n P√∫blica</p>
      </div>
      <div class="connection-status" id="connectionStatus">
        <div class="status-dot" id="statusDot"></div>
        <span id="statusText">Conectando...</span>
      </div>
    </div>

    <div class="chat-messages" id="chatMessages">
      <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-icon">üöÄ</div>
        <h1 class="welcome-title">¬°Hola! Soy Alex</h1>
        <p class="welcome-subtitle">
          Tu mentor de inteligencia artificial del GobLab Gran Canaria. Te ayudo a crear un plan de negocio profesional de forma conversacional y sencilla.
        </p>
        <button class="start-button" id="startBtn">Comenzar mi plan de negocio</button>
      </div>
    </div>

    <div class="chat-input">
      <div class="input-container">
        <textarea class="input-field" id="messageInput" placeholder="Escribe tu respuesta aqu√≠..." disabled></textarea>
        <button class="send-button" id="sendBtn" disabled>‚û§</button>
      </div>
    </div>
  </div>

  <div class="progress-panel">
    <div class="progress-header">
      <div class="progress-title">Tu Plan de Negocio</div>
      <div class="progress-subtitle">Cre√°ndose autom√°ticamente</div>
    </div>

    <div class="plan-preview" id="planPreview">
      <div class="plan-section" id="section-name">
        <div class="section-title"><div class="section-status">1</div>Tu Informaci√≥n</div>
        <div class="section-content">Esperando tu nombre...</div>
      </div>
      <div class="plan-section" id="section-idea">
        <div class="section-title"><div class="section-status">2</div>Tu Idea de Negocio</div>
        <div class="section-content">Pendiente de completar...</div>
      </div>
      <div class="plan-section" id="section-problem">
        <div class="section-title"><div class="section-status">3</div>Problema que Resuelves</div>
        <div class="section-content">Pendiente de completar...</div>
      </div>
      <div class="plan-section" id="section-customer">
        <div class="section-title"><div class="section-status">4</div>Cliente Objetivo</div>
        <div class="section-content">Pendiente de completar...</div>
      </div>
      <div class="plan-section" id="section-revenue">
        <div class="section-title"><div class="section-status">5</div>Modelo de Ingresos</div>
        <div class="section-content">Pendiente de completar...</div>
      </div>
      <div class="plan-section" id="section-research">
        <div class="section-title"><div class="section-status">6</div>Investigaci√≥n de Mercado</div>
        <div class="section-content">An√°lisis IA pendiente...</div>
      </div>
      <div class="plan-section" id="section-final">
        <div class="section-title"><div class="section-status">7</div>Plan Completo</div>
        <div class="section-content">Generaci√≥n final pendiente...</div>
      </div>
    </div>
  </div>
</div>

<script>
// ===================== CONFIGURACI√ìN SIMPLIFICADA =====================
const CONFIG = {
  webhookUrl: 'https://n8n.icc-e.org/webhook/mentor-chat',
  statusUrl: 'https://n8n.icc-e.org/webhook/mentor-chat-pdf',
  requestTimeout: 50000, // 50 segundos para evitar timeout de webhook
  pollingInterval: 15000 // Verificar PDF cada 15 segundos
};

// ===================== ESTADO Y DOM =====================
const state = {
  pdfReady: false,
  userId: `user_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,
  sessionId: `session_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,
  currentStep: 0,
  isConnected: false,
  isTyping: false,
  conversationData: {},
  isPolling: false
};

const elements = {
  startBtn: document.getElementById('startBtn'),
  sendBtn: document.getElementById('sendBtn'),
  messageInput: document.getElementById('messageInput'),
  chatMessages: document.getElementById('chatMessages'),
  welcomeScreen: document.getElementById('welcomeScreen'),
  statusDot: document.getElementById('statusDot'),
  statusText: document.getElementById('statusText')
};

const stepSectionMap = {
  1: 'section-name', 2: 'section-idea', 3: 'section-problem',
  4: 'section-customer', 5: 'section-revenue', 6: 'section-research', 7: 'section-final'
};

// ===================== INICIALIZACI√ìN =====================
document.addEventListener('DOMContentLoaded', () => {
  elements.startBtn.addEventListener('click', startConversation);
  elements.sendBtn.addEventListener('click', sendMessage);
  elements.messageInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  checkConnection();
  console.log('Alex MVP inicializado', { userId: state.userId, sessionId: state.sessionId });
});

// ===================== FUNCIONES PRINCIPALES =====================
async function checkConnection() {
  try {
    const response = await fetch(CONFIG.webhookUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: '_connection_test', userId: state.userId, sessionId: state.sessionId }),
      signal: AbortSignal.timeout(10000)
    });

    if (response.ok) {
      state.isConnected = true;
      setConnectionStatus(true, 'Conectado');
    } else {
      throw new Error(`HTTP ${response.status}`);
    }
  } catch (error) {
    console.error('Error de conexi√≥n:', error);
    setConnectionStatus(false, 'Error de conexi√≥n');
  }
}

function startConversation() {
  if (!state.isConnected) {
    showError('No hay conexi√≥n con el servidor. Reintentando...');
    checkConnection();
    return;
  }
  
  elements.welcomeScreen.style.display = 'none';
  elements.messageInput.disabled = false;
  elements.sendBtn.disabled = false;
  elements.messageInput.focus();

  setTimeout(() => processMessage('_iniciar_conversacion'), 500);
}

function sendMessage() {
  const message = elements.messageInput.value.trim();
  if (!message || state.isTyping) return;

  showUserMessage(message);
  elements.messageInput.value = '';
  removeQuickReplies();
  processMessage(message);
}

async function processMessage(message) {
  showTyping();

  const isGeneratingPlan = message.toLowerCase().includes('generar plan completo');

  const payload = {
    message,
    userId: state.userId,
    sessionId: state.sessionId,
    currentStep: state.currentStep,
    state: state.conversationData
  };

  try {
    const response = await fetch(CONFIG.webhookUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
      signal: AbortSignal.timeout(CONFIG.requestTimeout)
    });

    if (!response.ok) throw new Error(`HTTP ${response.status}`);

    const data = await response.json();
    hideTyping();
    handleResponse(data);

    // Iniciar polling si es generaci√≥n de plan
    if (isGeneratingPlan && !state.isPolling) {
      startPDFPolling();
    }

  } catch (error) {
    hideTyping();
    console.error('Error:', error);
    
    if (isGeneratingPlan) {
      showAIMessage("El proceso se est√° ejecutando. Verificando estado...");
      startPDFPolling();
    } else {
      showError('Error conectando con Alex. Intenta de nuevo.');
    }
  }
}

function handleResponse(data) {
  if (!data) return;

  // Manejar PDF completado (solo si no estamos en polling)
  if (data.pdfGenerated && data.pdfUrl && !state.isPolling) {
    state.isPolling = false; // Detener cualquier polling activo
    localStorage.setItem('alex_last_pdf_url', data.pdfUrl);
    for (let i = 1; i <= 7; i++) markSectionCompleted(i);
    
    showPDFReadyMessage(data.pdfUrl);
    return;
  }

  // Procesar respuesta normal
  const aiText = data.response || data.reply;
  if (aiText) showAIMessage(aiText);

  // Actualizar estado
  const previousStep = state.currentStep;
  if (data.currentStep !== undefined) {
    state.currentStep = parseInt(data.currentStep);
    if (data.currentStep > previousStep) {
      updatePlanSection(data.currentStep);
    }
  }
  
  if (data.state) state.conversationData = data.state;
  if (data.quickReplies?.length > 0) addQuickReplies(data.quickReplies);
}

// ===================== POLLING DE PDF =====================
async function startPDFPolling() {
  if (state.isPolling) return;
  state.isPolling = true;
  
  let attempts = 0;
  const maxAttempts = 24; // 6 minutos m√°ximo

  const poll = async () => {
    if (attempts >= maxAttempts) {
      state.isPolling = false;
      showError('El PDF est√° tardando m√°s de lo esperado.');
      return;
    }

    try {
      const response = await fetch(CONFIG.statusUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ sessionId: state.sessionId }),
        signal: AbortSignal.timeout(10000)
      });

      if (response.ok) {
        const data = await response.json();
        
        if (data.pdfGenerated && data.pdfUrl) {
          state.isPolling = false;
          localStorage.setItem('alex_last_pdf_url', data.pdfUrl);
          markSectionCompleted(7);
          
          showPDFReadyMessage();
          return;
        }
      }
      
      attempts++;
      if (attempts % 4 === 0) { // Cada minuto
        showAIMessage(`Generando tu plan... ${Math.min(80 + attempts * 2, 95)}% completado.`);
      }
      
      setTimeout(poll, CONFIG.pollingInterval);
      
    } catch (error) {
      attempts++;
      setTimeout(poll, CONFIG.pollingInterval);
    }
  };

  poll();
}

// ===================== FUNCIONES DE UI =====================
function updatePlanSection(currentStep) {
  const completedStep = currentStep - 1;
  
  for (let i = 1; i <= completedStep; i++) {
    markSectionCompleted(i);
  }
  
  if (currentStep <= 7) {
    const nextSectionId = stepSectionMap[currentStep];
    if (nextSectionId) activateSection(nextSectionId);
  }
}

function markSectionCompleted(stepNumber, content = null) {
  const sectionId = stepSectionMap[stepNumber];
  const section = document.getElementById(sectionId);
  if (!section) return;

  const status = section.querySelector('.section-status');
  const contentElement = section.querySelector('.section-content');

  section.classList.remove('active');
  section.classList.add('completed');
  status.classList.add('completed');
  status.textContent = '‚úì';
  
  if (content) {
    const shortText = content.length > 50 ? content.substring(0, 50) + '...' : content;
    contentElement.textContent = shortText;
  }

  if (stepNumber === 6) {
    contentElement.innerHTML = '<strong>An√°lisis completado:</strong><br>‚Ä¢ Mercado analizado<br>‚Ä¢ Competidores identificados';
  } else if (stepNumber === 7) {
    contentElement.innerHTML = '<strong>Plan generado:</strong><br>‚Ä¢ 25 p√°ginas profesionales<br>‚Ä¢ An√°lisis financiero';
  }
}

function activateSection(sectionId) {
  const section = document.getElementById(sectionId);
  if (section && !section.classList.contains('completed')) {
    section.classList.add('active');
    section.querySelector('.section-status').classList.add('active');
  }
}

function showUserMessage(message) {
  const messageDiv = document.createElement('div');
  messageDiv.className = 'message user';
  messageDiv.innerHTML = `
    <div class="message-avatar">üë§</div>
    <div class="message-content"><div class="message-text">${escapeHTML(message)}</div></div>`;
  elements.chatMessages.appendChild(messageDiv);
  scrollToBottom();
}

function showAIMessage(message, actions = []) {
  const messageDiv = document.createElement('div');
  messageDiv.className = 'message ai';
  let actionsHTML = '';
  if (actions.length > 0) {
    actionsHTML = '<div class="message-actions">' +
      actions.map(a => `<button class="action-btn" onclick="${a.handler}">${a.text}</button>`).join('') +
      '</div>';
  }
  messageDiv.innerHTML = `
    <div class="message-avatar">ü§ñ</div>
    <div class="message-content">
      <div class="message-text">${formatMessage(message)}</div>
      ${actionsHTML}
    </div>`;
  elements.chatMessages.appendChild(messageDiv);
  scrollToBottom();
}

function showError(message) {
  const errorDiv = document.createElement('div');
  errorDiv.className = 'error-message';
  errorDiv.innerHTML = `<span>‚ö†Ô∏è</span><span>${escapeHTML(message)}</span>`;
  elements.chatMessages.appendChild(errorDiv);
  scrollToBottom();
}

function showTyping() {
  if (document.getElementById('typing')) return;
  const typingDiv = document.createElement('div');
  typingDiv.className = 'typing-indicator';
  typingDiv.id = 'typing';
  typingDiv.innerHTML = `
    <div class="typing-dots">
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
    </div>
    <span>Alex est√° escribiendo...</span>`;
  elements.chatMessages.appendChild(typingDiv);
  state.isTyping = true;
  scrollToBottom();
}

function hideTyping() {
  const typing = document.getElementById('typing');
  if (typing) typing.remove();
  state.isTyping = false;
}

function addQuickReplies(replies) {
  setTimeout(() => {
    const quickDiv = document.createElement('div');
    quickDiv.className = 'quick-responses';
    quickDiv.id = 'quickReplies';
    quickDiv.innerHTML = replies.map(r => 
      `<div class="quick-response" onclick="selectQuickReply('${escapeHTML(r)}')">${escapeHTML(r)}</div>`
    ).join('');
    elements.chatMessages.appendChild(quickDiv);
    scrollToBottom();
  }, 400);
}

function selectQuickReply(reply) {
  if (reply === "Generar plan completo") {
    showUserMessage("Generar plan completo");
    removeQuickReplies();
    showAIMessage("¬°Perfecto! Estoy generando tu plan de negocio completo. Esto tomar√° unos momentos...");
    markSectionCompleted(6);
    activateSection('section-final');
    processMessage("Generar plan completo");
  } else {
    elements.messageInput.value = reply;
    sendMessage();
  }
}

function removeQuickReplies() {
  const quick = document.getElementById('quickReplies');
  if (quick) quick.remove();
}

function setConnectionStatus(connected, message) {
  state.isConnected = connected;
  elements.statusDot.classList.toggle('connected', connected);
  elements.statusText.textContent = message;
}

function scrollToBottom() {
  elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
}

function showPDFReadyMessage() {
  showAIMessage(
    '¬°Tu Plan de Negocio est√° listo! He creado un documento profesional con an√°lisis espec√≠fico para Gran Canaria.',
    [
      { text: 'üìÑ Descargar PDF', handler: 'downloadPlan()' },
      { text: 'üìß Enviar por email', handler: 'promptEmailAndSend()' },
      { text: 'üí¨ Hacer consultas', handler: 'askQuestions()' }
    ]
  );
}

// ===================== FUNCIONES DE UTILIDAD =====================
function escapeHTML(text) { 
  const div = document.createElement('div'); 
  div.textContent = text; 
  return div.innerHTML; 
}

function formatMessage(text) {
  return String(text || '')
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.*?)\*/g, '<em>$1</em>')
    .replace(/\n/g, '<br>');
}

// ===================== FUNCIONES PRINCIPALES =====================
function downloadPlan() {
  const pdfUrl = localStorage.getItem('alex_last_pdf_url');
  if (pdfUrl) {
    window.open(pdfUrl, '_blank');
    showAIMessage('‚úÖ Abriendo tu PDF en una nueva pesta√±a.');
  } else {
    showError('No se encontr√≥ un PDF generado.');
  }
}

async function promptEmailAndSend() {
  const email = prompt('¬øA qu√© direcci√≥n de email quieres enviar tu plan?\n\nEjemplo: nombre@gmail.com');
  if (!email) return;
  
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    showError('Por favor introduce un email v√°lido');
    return;
  }
  
  const pdfUrl = localStorage.getItem('alex_last_pdf_url');
  if (!pdfUrl) {
    showError('No se encontr√≥ un PDF generado.');
    return;
  }
  
  showAIMessage(`üìß Enviando tu plan a ${email}...`);
  
  try {
    const response = await fetch(CONFIG.webhookUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        message: '_send_email',
        to: email,
        pdfUrl: pdfUrl,
        userId: state.userId,
        sessionId: state.sessionId,
        state: state.conversationData
      })
    });

    if (response.ok) {
      showAIMessage(`‚úÖ ¬°Plan enviado exitosamente a ${email}!`);
    } else {
      throw new Error('Error del servidor');
    }
  } catch (error) {
    showError('No se pudo enviar el email. Puedes descargar el PDF directamente.');
  }
}

function askQuestions() {
  showAIMessage(`¬°Perfecto! Ahora puedo responder preguntas espec√≠ficas sobre tu plan de negocio.
  
  Puedes preguntarme sobre:
  ‚Ä¢ Detalles de financiaci√≥n disponible
  ‚Ä¢ Estrategias de marketing para tu cliente objetivo
  ‚Ä¢ An√°lisis de competencia en tu sector
  ‚Ä¢ Proyecciones financieras m√°s detalladas
  ‚Ä¢ Pasos legales para constituir tu empresa
  ‚Ä¢ Contactos y recursos en Gran Canaria
  
  ¬øQu√© te gustar√≠a saber?`);
  
  elements.messageInput.placeholder = 'Haz tu pregunta sobre el plan de negocio...';
  elements.messageInput.focus();
}

// Exponer funciones globalmente
window.downloadPlan = downloadPlan;
window.promptEmailAndSend = promptEmailAndSend;
window.askQuestions = askQuestions;
window.selectQuickReply = selectQuickReply;
</script>
</body>
</html>